# Change Log

| Change | Date | Version | Description | Author |
|--------|------|---------|-------------|--------|
| Initial Draft | 2025-10-01 | 1.0 | Created technical PRD with project context, complete requirements, and architecture decisions | John (PM Agent) |
| Technical Refinements | 2025-10-01 | 1.1 | Added: users/user_profiles table split, user_tags audit fields, centralized error handling, centralized utilities, minimal monitoring approach, Vitest testing strategy | John (PM Agent) |
| Consistency Check & Fixes | 2025-10-01 | 1.2 | Renumbered FRs sequentially (FR1-FR102), added missing requirements (avatar management, taxonomy storage, preset locations, calendar disconnect, reminder preferences), clarified dormant vs deactivated users, updated schema (actual_duration_minutes, reminder_preference, avatar fields, taxonomy table, tier_override_tokens), added approve link token documentation | John (PM Agent) |
| Internal Consistency Audit | 2025-10-01 | 1.3 | Schema updates: taxonomy approval workflow (source, is_approved, requested_by, approved_by fields), user_tags admin source type, avatar_metadata JSONB, tier_override_requests scope/expiration, calendar_integrations one-per-user constraint, notification_type tag_approval_pending. Clarified: FR62/FR63 meeting duration (nullable for in-person), FR57 dormant users (no scheduled meetings), NFR31 webhook sync/async split, NFR34 openapi-typescript for frontend types. Added: INotificationProvider.sendTagApprovalNotification, email template specifications, avatars storage bucket, data seeding section | John (PM Agent) |
| Post-Review Updates | 2025-10-01 | 1.4 | **SCOPE CHANGE:** Calendar sync now mandatory for all users (FR105-FR107). Consolidated FR19/FR31 (mentor reach-out with auto-exception). Updated FR11 (manual tags only for MVP, defer AI to post-MVP). Clarified FR62/FR63 (meeting duration fetched 1hr after end, best-effort). Updated NFR5/NFR28 (scoped realtime subscriptions). Schema: tier_override_requests.expires_at now required (7-day expiration), bookings.actual_duration_minutes clarified. API: Added /taxonomy endpoints (GET /, GET /pending, PUT /:id/approve, PUT /:id/reject). Google Meet link logic: prefer mentee's Google account, fallback to mentor, manual link for Outlook-only meetings. Reputation: added probationary clamp logic (isProbationary flag). Section 4.10: Added complete Airtable field mapping documentation | John (PM Agent) |
| OAuth Flow Simplification | 2025-10-01 | 1.5 | **UX IMPROVEMENT:** OAuth signup (Google/Microsoft) now requests both auth + calendar permissions in single combined flow (FR2, FR108). Magic link users see dismissible banner, prompted for calendar only when attempting booking/availability actions (action-level blocking per FR105). Coordinators exempt from calendar requirement. Schema: calendar_integrations.connection_method added (oauth_signup vs post_login). UI: Updated authentication flow screens with OAuth scope details, calendar connection banner/modal, action-level blocking. UX flows updated to reflect OAuth auto-connection and just-in-time prompts for magic link users. API: Documented combined OAuth flow and post-login calendar connection. Section 3.3: Added calendar permission scopes, action-level blocking requirements | John (PM Agent) |
| Data Model Restructuring | 2025-10-03 | 2.0 | **BREAKING CHANGE:** Restructured data model for polymorphic relationships and scalability. Changed: Renamed `user_tags` â†’ `entity_tags`, split tag definitions into `taxonomy` table with hierarchical support (`parent_id`). Removed URL fields (`linkedin_url`, `website_url`, `pitch_vc_url`, `additional_links`) from `user_profiles`, added centralized `urls` + `entity_urls` tables for URL deduplication and polymorphic entity linking. Added `portfolio_companies` table with `portfolio_company_id` reference in `user_profiles` (mutually exclusive with `company` field for mentors). Added comprehensive audit trail fields (`created_by`, `updated_by`, `deleted_by`) across all tables. Updated Airtable field mapping, Epic 1 acceptance criteria, and user story PROFILE-LINKS-001 to reflect new structure. Taxonomy now supports hierarchical relationships and `sample_data` source type | Sarah (PO Agent) |
| Internal Consistency Resolution | 2025-10-01 | 1.6 | **CONSISTENCY FIXES:** Clarified coordinator calendar exemption in schema documentation (application-level enforcement). Expanded FR93 with calendar disconnection behavior (warning on active bookings, manual cleanup responsibility, email notifications continue). Updated tier override expiration logic: approved overrides expire 7 days after approval (not creation), mentor-initiated overrides auto-approved. Updated FR54 to reflect new expiration model. FR107 clarified: tag approval notifications use delivery_channel='both'. FR57 expanded: dormant status is user-wide (90+ days no meetings in any role), tracked via users.last_activity_at. **SCOPE REDUCTION:** Removed meeting duration tracking from MVP (FR62/FR63 simplified, bookings.actual_duration_minutes removed, moved to FE12). API: Added POST /mentors/:mentorId/send-interest with auto-approval logic for tier-restricted mentor-initiated requests. UI: Added SlotPicker realtime subscription implementation example (scoped per NFR28) | John (PM Agent) |
| Epic & Story Structure | 2025-10-02 | 1.7 | **SECTION COMPLETE:** Added comprehensive Section 5 (Epic and Story Structure) with 9 epics, 78 user stories, acceptance criteria, priority levels, dependencies, sprint breakdown, and 18-week estimated timeline. Status: PRD now 100% complete and ready for epic/story generation. All requirements mapped to implementable stories with clear dependencies and acceptance criteria | John (PM Agent) |
| Walking Skeleton Restructure | 2025-10-02 | 2.0 | **MAJOR RESTRUCTURE:** Reorganized all epics using Walking Skeleton approach for faster time-to-value. Added Epic 0 (18 stories) delivering end-to-end working product by Week 4. Mock data seeding replaces Airtable dependency for initial development. Resequenced Epics 1-8 to iteratively add depth (infrastructure, OAuth, calendar, advanced booking, Airtable sync, matching, reputation, admin). Total: 86 stories across 10 sprints (20 weeks). Key improvement: working product in 4 weeks vs. 12 weeks, enabling early user feedback and risk mitigation. All stories renumbered (SKEL-*, INFRA-*, AUTH-*, PROFILE-*, CAL-*, AVAIL-*, BOOK-*, AIRTABLE-*, MATCH-*, REP-*, ADMIN-*) | John (PM Agent) |
| Alignment Review & Clarifications | 2025-10-03 | 2.1 | **COMPREHENSIVE REVIEW:** Internal alignment audit completed based on user feedback. **Clarifications Added:** (1) Portfolio companies vs company field: mentees use `portfolio_company_id` (FK), mentors use `company` (text), Airtable syncs companies before users. (2) URL handling: each URL type is separate Airtable column, extracted and deduplicated in `urls` table. (3) Taxonomy hierarchy: Airtable provides `Name` and `Parent` columns, parent-child ordering guaranteed by Airtable. (4) Coordinator broadcasts: multiple `notification_log` entries created (one per coordinator), no groups in MVP. (5) Cascade soft-deletes: user deletion soft-deletes availability/time_slots, preserves past bookings, cancels future bookings. (6) Tier override expiration: pending requests auto-rejected after 7 days (truly locked), mentee can resubmit. (7) Booking request flow: added `status='pending'`, 7-day timeout, responsiveness tracking via `confirmed_at - created_at`. (8) Airtable webhook: HMAC-SHA256 signature validation via `X-Airtable-Content-MAC` header. (9) Single-role constraint: users can only have one role in MVP (separate accounts required for dual roles). Updated schema, story acceptance criteria, and reputation calculation documentation | Sarah (PO Agent) |
| URL Model Simplification | 2025-10-03 | 2.2 | **BREAKING CHANGE:** Simplified URL storage model per architecture.md v1.3. Removed polymorphic complexity: deleted `urls` table (centralized deduplication - premature optimization) and `entity_urls` table (polymorphic junction). Added direct URL columns to `portfolio_companies` table (`website`, `pitch_vc_url`, `linkedin_url`). Replaced `entity_urls` with dedicated `user_urls` table (non-polymorphic, direct `user_id` FK). Updated all references: schema documentation, Airtable sync logic (Section 4.10), Epic 1 acceptance criteria (INFRA-DB-001), user story PROFILE-LINKS-001, and seed data documentation. This change reduces join complexity and improves query performance while maintaining all required URL storage functionality | Sarah (PO Agent) |
| Booking Confirmation Flow & Calendar Events Clarification | 2025-10-03 | 2.4 | **CRITICAL CLARIFICATIONS:** (1) Booking confirmation flow: Updated FR29 to clarify pending/confirmed states with 7-day expiration. Updated FR32 with three-email touchpoint flow (request creation, confirmation, expiration). Updated FR36 to specify calendar events created only after confirmation with single event model (both parties as attendees). Updated FR40-FR42 to clarify real-time slot reservation behavior (pending bookings immediately reserve slots, expired bookings free slots in real-time). (2) Tag approval workflow scope: Moved FR92 and FR107 to post-MVP Future Enhancements (FE35, FE36). In MVP, user-submitted tags are saved but not displayed; coordinators manually approve via database. (3) Google Meet and calendar events: Clarified that system creates single calendar event with both mentor and mentee as attendees, with implementation details deferred to development (calendar provider API research required). Added FE34 for calendar event modification support (post-MVP) | Sarah (PO Agent) |
